[workspace]
resolver = "2"
members = [
    "crates/flui_types",        # Base types - no dependencies
    "crates/flui-foundation",   # Foundation types and utilities
    "crates/flui-tree",         # Tree abstractions
    "crates/flui-view",         # View traits and abstractions
    "crates/flui-pipeline",     # Pipeline orchestration (build/layout/paint)
    "crates/flui_assets",       # Asset management system
    "crates/flui_log",          # Cross-platform logging
    "crates/flui_core",         # Core with foundation utilities
    "crates/flui_rendering",
    "crates/flui_widgets",
    "crates/flui_app",
    "crates/flui_painting",
    "crates/flui_engine",       # Rendering engine - Layer/Scene/Painter
    "crates/flui_derive",
    "crates/flui_devtools",
    "crates/flui_interaction",  # Event routing, interaction, and gesture recognition
    "crates/flui_animation",    # Animation system
    "crates/flui-scheduler",    # Frame scheduling and task prioritization
    "crates/flui-reactivity",   # Reactive state management with hooks and signals
    "crates/flui_cli",          # CLI tool for project management
    "crates/flui_build",        # Build system library for cross-platform builds
]

[workspace.package]
version = "0.1.0"
edition = "2021"
rust-version = "1.91"
license = "MIT OR Apache-2.0"
authors = ["Flui Contributors"]
repository = "https://github.com/yourusername/flui"

[workspace.dependencies]
# ASYNC RUNTIME (Stable: 1.43 LTS - March 2026)
tokio = { version = "1.43", features = ["full"] }
futures = "0.3"
pin-project-lite = "0.2"
any_spawner = "0.1"
send_wrapper = "0.6"

# SYNCHRONIZATION - Used by multiple crates
parking_lot = "0.12"
once_cell = "1.20"
dashmap = "6.1"
crossbeam = "0.8"

# COLLECTIONS - Used by multiple crates
smallvec = { version = "1.13", features = ["serde", "union"] }

# SERIALIZATION - Core functionality
serde = { version = "1.0", features = ["derive", "rc"] }
serde_json = "1.0"

# BUILDER UTILITIES - Used by widgets
bon = "3.8"

# ERROR HANDLING & LOGGING - Used everywhere
thiserror = "2.0"
anyhow = "1.0"
tracing = "0.1"
tracing-subscriber = { version = "0.3", features = ["env-filter", "fmt", "ansi"] }
tracing-forest = { version = "0.3", features = ["ansi", "smallvec"] }

# === Shared GPU/Window dependencies ===
# Used by flui_engine, flui_app, and root examples
# GPU RENDERING (WGPU BACKEND) - Version 25.x (stable)
# Note: wgpu 26.0+ and 27.0.x have compilation issues with codespan-reporting
# The bug is in codespan library itself (feature-flag incompatibility)
# See: https://github.com/gfx-rs/wgpu/issues/7915
# Staying on wgpu 25.x until upstream fix
wgpu = { version = "25.0", default-features = false, features = ["wgsl"] }
winit = "0.30.12"
pollster = "0.4"

# IMAGE PROCESSING - Used by flui_assets and flui_engine
image = { version = "0.25", default-features = false, features = ["png", "jpeg", "gif", "webp"] }

# FONT PARSING - Used by flui_assets and flui_engine
ttf-parser = "0.25"

# === Engine-specific dependencies (NOT in workspace) ===
# These are ONLY used in flui_engine:
# - glam (GPU math)
# - glyphon, cosmic-text (text rendering)
# - lyon (tessellation)
# - guillotiere (texture atlas)
# - bytemuck

# CACHING - Used by flui_core and flui_assets
moka = { version = "0.12", features = ["future"] }

# NETWORKING - Used by flui_assets
reqwest = { version = "0.12", features = ["json", "stream", "rustls-tls"] }

# UTILITIES - Used by multiple crates
ahash = "0.8"
bitflags = "2.10"
dyn-clone = "1.0"
downcast-rs = "2.0.2"

# STRING INTERNING - Used by flui_assets
lasso = { version = "0.7", features = ["multi-threaded"] }

# OPTIMIZED SMART POINTERS - Used by flui_assets
triomphe = "0.1"

# PERFORMANCE & PROFILING
criterion = "0.7"
tracing-tracy = "0.11"
puffin_http = "0.16"

[package]
name = "flui"
version.workspace = true
edition.workspace = true
rust-version.workspace = true
license.workspace = true
description = "Flutter-inspired declarative UI framework with wgpu rendering"
keywords = ["gui", "ui", "wgpu", "flutter", "reactive"]

[dependencies]
# Flui crates - all included in workspace
flui_types = { path = "crates/flui_types" }
flui_core = { path = "crates/flui_core" }
flui_painting = { path = "crates/flui_painting" }
flui_engine = { path = "crates/flui_engine" }
flui_rendering = { path = "crates/flui_rendering" }
flui_animation = { path = "crates/flui_animation" }
flui_interaction = { path = "crates/flui_interaction" }
flui_app = { path = "crates/flui_app" }
flui_widgets = { path = "crates/flui_widgets" }
tracing.workspace = true
tracing-subscriber.workspace = true
tracing-forest.workspace = true

[dev-dependencies]
# criterion only needed in individual crates for benchmarks, not in root

[features]
default = []

# === Core Features ===
# Serialization support across all crates
serde = [
    "flui_core/serde",
    "flui_types/serde",
    "flui_rendering/serde",
]

# === Performance Features ===
# Multi-threaded parallel processing
parallel = ["flui_core/parallel"]

# === Profiling & Debug Features ===
# TODO: Fix puffin dependencies before enabling
# profiling = ["puffin", "puffin_http", "flui_core/profiling"]
# tracy = ["tracing-tracy"]
# full-profiling = ["profiling", "tracy"]

# === DevTools Features ===
# Developer tools integration
devtools = ["flui_engine/devtools"]

# TODO: Re-enable when memory-profiler dependencies are fixed
# memory-profiler = ["devtools", "flui_engine/memory-profiler"]

# === Convenience Features ===
# Enable all stable features (excludes experimental)
full = ["serde", "parallel", "devtools"]

[profile.release]
opt-level = 3
lto = "thin"
codegen-units = 1
strip = "debuginfo"  # Strip debug symbols but keep android_main symbol
panic = "abort"

[profile.dev]
opt-level = 1

[profile.dev.package."*"]
opt-level = 2
