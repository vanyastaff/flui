[workspace]
resolver = "2"
members = [
    # === Phase 1: Foundation Layer ===
    "crates/flui_types",          # Base types with Unit system (ACTIVE)
    "crates/flui-foundation",     # Foundation types and utilities (ACTIVE)
    "crates/flui-tree",           # Tree abstractions (ACTIVE)
    "crates/flui-platform",       # Platform abstraction traits (ACTIVE - Phase 1)

    # === Temporarily disabled until Phase 1 complete ===
    # "crates/flui-layer",
    # "crates/flui-semantics",
    # "crates/flui_interaction",
    # "crates/flui_painting",
    # "crates/flui_rendering",
    # "crates/flui-view",
    # "crates/flui-scheduler",
    # "crates/flui_animation",
    # "crates/flui-reactivity",
    # "crates/flui_engine",
    # "crates/flui_log",
    # "crates/flui_app",
    # "crates/flui_widgets",
    # "crates/flui_devtools",
    # "crates/flui_cli",
    # "crates/flui_build",
]

[workspace.package]
version = "0.1.0"
edition = "2021"
rust-version = "1.91"
license = "MIT OR Apache-2.0"
authors = ["Flui Contributors"]
repository = "https://github.com/yourusername/flui"

[workspace.dependencies]
# ASYNC RUNTIME (Stable: 1.43 LTS - March 2026)
tokio = { version = "1.43", features = ["full"] }
futures = "0.3"
pin-project-lite = "0.2"
any_spawner = "0.1"
send_wrapper = "0.6"

# SYNCHRONIZATION - Used by multiple crates
parking_lot = "0.12"
once_cell = "1.20"
dashmap = "6.1"
crossbeam = "0.8"

# COLLECTIONS - Used by multiple crates
smallvec = { version = "1.13", features = ["serde", "union", "const_generics"] }

# SERIALIZATION - Core functionality
serde = { version = "1.0", features = ["derive", "rc"] }
serde_json = "1.0"

# BUILDER UTILITIES - Used by widgets
bon = "3.8"

# DELEGATION - Used by flui-tree and flui_rendering
ambassador = "0.4.2"

# ERROR HANDLING & LOGGING - Used everywhere
thiserror = "2.0"
anyhow = "1.0"
tracing = "0.1"
tracing-subscriber = { version = "0.3", features = ["env-filter", "fmt", "ansi"] }
tracing-forest = { version = "0.3", features = ["smallvec"] }

# === Shared GPU/Window dependencies ===
# Used by flui_engine, flui_app, and root examples
# GPU RENDERING (WGPU BACKEND) - Version 25.x (stable)
# Note: wgpu 26.0+ and 27.0.x have compilation issues with codespan-reporting
# The bug is in codespan library itself (feature-flag incompatibility)
# See: https://github.com/gfx-rs/wgpu/issues/7915
# Staying on wgpu 25.x until upstream fix
wgpu = { version = "25.0", default-features = false, features = ["wgsl"] }
winit = "0.30.12"
pollster = "0.4"

# CLIPBOARD - Cross-platform clipboard access
arboard = "3.4"

# IMAGE PROCESSING - Used by flui_assets and flui_engine
# TODO: Re-enable "webp" feature when image-webp is fixed for Rust 1.91+
# See: https://github.com/image-rs/image-webp/issues/102
image = { version = "0.25", default-features = false, features = ["png", "jpeg", "gif"] }

# FONT PARSING - Used by flui_assets and flui_engine
ttf-parser = "0.25"

# === Engine-specific dependencies (NOT in workspace) ===
# These are ONLY used in flui_engine:
# - glam (GPU math)
# - glyphon, cosmic-text (text rendering)
# - lyon (tessellation)
# - guillotiere (texture atlas)
# - bytemuck

# CACHING - Used by flui_core and flui_assets
moka = { version = "0.12", features = ["future"] }

# NETWORKING - Used by flui_assets
reqwest = { version = "0.12", features = ["json", "stream", "rustls-tls"] }

# UI EVENTS - Cross-platform input event abstraction (W3C compliant)
ui-events = "0.2"
ui-events-winit = "0.2"
cursor-icon = "1.2"

# UTILITIES - Used by multiple crates
ahash = "0.8"
bitflags = "2.10"
dyn-clone = "1.0"
downcast-rs = "2.0.2"
which = "5.0" # Command discovery - Used by flui_build
indicatif = "0.17" # Progress bars - Used by flui_build

# STRING INTERNING - Used by flui_assets
lasso = { version = "0.7", features = ["multi-threaded"] }

# OPTIMIZED SMART POINTERS - Used by flui_assets
triomphe = "0.1"

# PERFORMANCE & PROFILING
criterion = "0.7"
tracing-tracy = "0.11"
puffin_http = "0.16"

# Workspace-wide lints for consistent code quality (Rust 1.74+)
[workspace.lints.rust]
unsafe_code = "warn"
missing_docs = "warn"
missing_debug_implementations = "warn"
rust_2018_idioms = "warn"

[workspace.lints.clippy]
# Lint groups need lower priority to allow individual lint overrides
all = { level = "warn", priority = -1 }
pedantic = { level = "warn", priority = -1 }
# Allow reasonable exceptions
cast_precision_loss = "allow"
module_name_repetitions = "allow"
too_many_lines = "allow"
missing_errors_doc = "allow"
missing_panics_doc = "allow"

[package]
name = "flui"
version.workspace = true
edition.workspace = true
rust-version.workspace = true
license.workspace = true
description = "Flutter-inspired declarative UI framework with wgpu rendering"
keywords = ["gui", "ui", "wgpu", "flutter", "reactive"]

[dependencies]
# === Foundation Layer ===
flui_types = { path = "crates/flui_types" }
flui-foundation = { path = "crates/flui-foundation" }
flui-tree = { path = "crates/flui-tree" }

# === Core Layer ===
flui-layer = { path = "crates/flui-layer" }
flui-semantics = { path = "crates/flui-semantics" }
flui_interaction = { path = "crates/flui_interaction" }
flui_painting = { path = "crates/flui_painting" }

# === Rendering Layer ===
flui_rendering = { path = "crates/flui_rendering" }
# flui_engine = { path = "crates/flui_engine" }  # GPU backend - enable when needed

# === View Layer ===
flui-view = { path = "crates/flui-view" }

# === Reactive Layer ===
flui-scheduler = { path = "crates/flui-scheduler" }
flui_animation = { path = "crates/flui_animation" }
flui-reactivity = { path = "crates/flui-reactivity" }

# === Application Layer ===
flui_app = { path = "crates/flui_app" }

# === Widgets (when stable) ===
# flui_widgets = { path = "crates/flui_widgets" }

# === Logging ===
tracing.workspace = true
tracing-subscriber.workspace = true
tracing-forest.workspace = true

[dev-dependencies]
# criterion only needed in individual crates for benchmarks, not in root

[features]
default = []

# === Core Features ===
# Serialization support across all crates
serde = [
    # "flui_core/serde",  # Temporarily disabled
    "flui_types/serde",
    "flui_rendering/serde",
]

# === Performance Features ===
# Multi-threaded parallel processing (temporarily disabled)
# parallel = ["flui_core/parallel"]

# === Profiling & Debug Features ===
# TODO: Fix puffin dependencies before enabling
# profiling = ["puffin", "puffin_http", "flui_core/profiling"]
# tracy = ["tracing-tracy"]
# full-profiling = ["profiling", "tracy"]

# === DevTools Features ===
# Developer tools integration (temporarily disabled)
# devtools = ["flui_engine/devtools"]

# TODO: Re-enable when memory-profiler dependencies are fixed
# memory-profiler = ["devtools", "flui_engine/memory-profiler"]

# === Convenience Features ===
# Enable all stable features (temporarily disabled)
# full = ["serde", "parallel", "devtools"]

# ═══════════════════════════════════════════════════════════════════════════════
# Build Profiles
# ═══════════════════════════════════════════════════════════════════════════════

[profile.dev]
opt-level = 1           # Some optimization for faster runtime
incremental = true      # Faster rebuilds

[profile.dev.package."*"]
opt-level = 2           # Optimize dependencies (they don't change often)

[profile.release]
opt-level = 3
lto = "thin"            # Link-time optimization (good balance)
codegen-units = 1       # Better optimization, slower compile
strip = "symbols"       # Smaller binary
